<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Manager - Babatunde's Barber Studio</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            min-height: 100vh;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .admin-header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .admin-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .sync-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .sync-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .sync-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: transform 0.2s;
        }
        
        .sync-btn:hover {
            transform: translateY(-2px);
        }
        
        .sync-btn.export {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .sync-btn.import {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-left: 4px solid var(--primary-color);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .bookings-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0;
        }
        
        .refresh-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }
        
        .bookings-grid {
            display: grid;
            gap: 20px;
        }
        
        .booking-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            transition: var(--transition);
            position: relative;
        }
        
        .booking-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .booking-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .booking-id {
            background: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        .booking-date {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .booking-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #666;
            font-weight: 500;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-size: 1rem;
            color: #333;
            font-weight: 600;
        }
        
        .service-name {
            color: var(--primary-color);
        }
        
        .price {
            color: var(--accent-color);
            font-size: 1.1rem;
        }
        
        .additional-services {
            background: #e8f4f8;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .additional-services .detail-label {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .additional-services .detail-value {
            font-size: 0.9rem;
            color: #555;
        }
        
        .booking-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .cancel-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
        }
        
        .cancel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .no-bookings {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .no-bookings i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .no-bookings h3 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            color: #999;
        }
        
        .no-bookings p {
            margin: 0;
            font-size: 1rem;
        }
        
        .back-to-site {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            z-index: 1000;
        }
        
        .back-to-site:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            color: white;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 10px;
            }
            
            .admin-header h1 {
                font-size: 2rem;
            }
            
            .booking-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .booking-actions {
                flex-direction: column;
            }
            
            .back-to-site {
                position: relative;
                top: auto;
                left: auto;
                display: inline-block;
                margin-bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-to-site">
        <i class="fas fa-arrow-left"></i> Back to Website
    </a>
    
    <div class="admin-container">
        <div class="admin-header">
            <h1><i class="fas fa-calendar-check"></i> Booking Manager</h1>
            <p>Manage all customer bookings and availability</p>
        </div>
        
        <!-- Data Sync Section -->
        <div class="sync-section">
            <h3><i class="fas fa-sync-alt"></i> Sync with Live Website</h3>
            <p>Export data from your live website and import it here to keep everything in sync.</p>
            <div class="sync-buttons">
                <button class="sync-btn export" onclick="exportData()">
                    <i class="fas fa-download"></i> Export Current Data
                </button>
                <button class="sync-btn import" onclick="importData()">
                    <i class="fas fa-upload"></i> Import Live Data
                </button>
                <button class="sync-btn" onclick="clearAllData()">
                    <i class="fas fa-trash"></i> Clear All Data
                </button>
            </div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-bookings">0</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="today-bookings">0</div>
                <div class="stat-label">Today's Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="this-week-bookings">0</div>
                <div class="stat-label">This Week</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-revenue">$0</div>
                <div class="stat-label">Total Revenue</div>
            </div>
        </div>
        
        <div class="bookings-section">
            <div class="section-header">
                <h2 class="section-title">All Bookings</h2>
                <button class="refresh-btn" onclick="loadBookings()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            
            <div id="bookings-container">
                <div class="no-bookings">
                    <i class="fas fa-calendar-times"></i>
                    <h3>No Bookings Yet</h3>
                    <p>Bookings will appear here once customers start making appointments</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allBookings = [];
        
        // Load bookings from localStorage
        function loadBookings() {
            const storedBookings = localStorage.getItem('babatundeBarberBookings');
            if (storedBookings) {
                allBookings = JSON.parse(storedBookings);
            } else {
                allBookings = [];
            }
            
            updateStats();
            displayBookings();
        }
        
        // Export all data (bookings + schedule)
        function exportData() {
            const bookings = localStorage.getItem('babatundeBarberBookings') || '[]';
            const schedule = localStorage.getItem('babatundeBarberSchedule') || '{}';
            
            const exportData = {
                bookings: JSON.parse(bookings),
                schedule: JSON.parse(schedule),
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `barbershop-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Data exported successfully!');
        }
        
        // Import data from live website
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.bookings) {
                            localStorage.setItem('babatundeBarberBookings', JSON.stringify(data.bookings));
                        }
                        
                        if (data.schedule) {
                            localStorage.setItem('babatundeBarberSchedule', JSON.stringify(data.schedule));
                        }
                        
                        loadBookings();
                        alert('Data imported successfully!');
                    } catch (error) {
                        alert('Error importing data: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Are you sure you want to clear ALL data? This cannot be undone!')) {
                localStorage.removeItem('babatundeBarberBookings');
                localStorage.removeItem('babatundeBarberSchedule');
                allBookings = [];
                displayBookings();
                updateStats();
                alert('All data cleared!');
            }
        }
        
        // Update statistics
        function updateStats() {
            const totalBookings = allBookings.length;
            const today = new Date().toDateString();
            const todayBookings = allBookings.filter(booking => 
                new Date(booking.date + 'T12:00:00').toDateString() === today
            ).length;
            
            const thisWeek = getWeekDates();
            const thisWeekBookings = allBookings.filter(booking => {
                const bookingDate = new Date(booking.date + 'T12:00:00');
                return bookingDate >= thisWeek.start && bookingDate <= thisWeek.end;
            }).length;
            
            const totalRevenue = allBookings.reduce((sum, booking) => {
                return sum + booking.totalPrice;
            }, 0);
            
            document.getElementById('total-bookings').textContent = totalBookings;
            document.getElementById('today-bookings').textContent = todayBookings;
            document.getElementById('this-week-bookings').textContent = thisWeekBookings;
            document.getElementById('total-revenue').textContent = `$${totalRevenue}`;
        }
        
        // Get current week dates
        function getWeekDates() {
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay());
            startOfWeek.setHours(0, 0, 0, 0);
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            return { start: startOfWeek, end: endOfWeek };
        }
        
        // Display all bookings
        function displayBookings() {
            const container = document.getElementById('bookings-container');
            
            if (allBookings.length === 0) {
                container.innerHTML = `
                    <div class="no-bookings">
                        <i class="fas fa-calendar-times"></i>
                        <h3>No Bookings Yet</h3>
                        <p>Bookings will appear here once customers start making appointments</p>
                    </div>
                `;
                return;
            }
            
            // Sort bookings by date (newest first)
            const sortedBookings = [...allBookings].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = sortedBookings.map(booking => {
                console.log('=== BOOKING DISPLAY DEBUG ===');
                console.log('Raw booking.date:', booking.date);
                console.log('Booking object:', booking);
                
                // Fix timezone issue: use same parsing method as booking system
                const bookingDate = new Date(booking.date + 'T12:00:00');
                console.log('Parsed bookingDate:', bookingDate);
                console.log('BookingDate toLocaleDateString:', bookingDate.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }));
                
                const formattedDate = bookingDate.toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                console.log('=== END BOOKING DISPLAY DEBUG ===');
                
                const additionalServicesText = booking.additionalServices && booking.additionalServices.length > 0 
                    ? booking.additionalServices.map(service => {
                        const serviceNames = {
                            'design-option': 'Custom Design',
                            'beard-trim': 'Beard Trim',
                            'mustache-trim': 'Mustache Trim',
                            'eyebrow-trim': 'Eyebrow Trim',
                            'hot-towel': 'Hot Towel Treatment',
                            'hair-wash': 'Hair Wash & Style'
                        };
                        return serviceNames[service] || service;
                    }).join(', ')
                    : 'None';
                
                return `
                    <div class="booking-card" data-booking-id="${booking.confirmationNumber}">
                        <div class="booking-header">
                            <div class="booking-id">${booking.confirmationNumber}</div>
                            <div class="booking-date">${formattedDate}</div>
                        </div>
                        
                        <div class="booking-details">
                            <div class="detail-item">
                                <div class="detail-label">Customer</div>
                                <div class="detail-value">${booking.customerInfo.name}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Email</div>
                                <div class="detail-value">${booking.customerInfo.email}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Phone</div>
                                <div class="detail-value">${booking.customerInfo.phone}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Time</div>
                                <div class="detail-value">${formatTime(booking.time)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Service</div>
                                <div class="detail-value service-name">${booking.serviceName}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Price</div>
                                <div class="detail-value price">$${booking.totalPrice}.00</div>
                            </div>
                        </div>
                        
                        ${additionalServicesText !== 'None' ? `
                            <div class="additional-services">
                                <div class="detail-label">Additional Services</div>
                                <div class="detail-value">${additionalServicesText}</div>
                            </div>
                        ` : ''}
                        
                        ${booking.customerInfo.notes ? `
                            <div class="detail-item">
                                <div class="detail-label">Special Notes</div>
                                <div class="detail-value">${booking.customerInfo.notes}</div>
                            </div>
                        ` : ''}
                        
                        <div class="booking-actions">
                            <button class="cancel-btn" onclick="cancelBooking('${booking.confirmationNumber}')">
                                <i class="fas fa-times"></i> Cancel Booking
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Cancel a booking
        function cancelBooking(confirmationNumber) {
            if (!confirm('Are you sure you want to cancel this booking? This action cannot be undone.')) {
                return;
            }
            
            // Find the booking
            const bookingIndex = allBookings.findIndex(booking => booking.confirmationNumber === confirmationNumber);
            if (bookingIndex === -1) {
                showNotification('Booking not found!', 'error');
                return;
            }
            
            const booking = allBookings[bookingIndex];
            
            // Add the time slot back to availability
            addTimeSlotBackToSchedule(booking.date, booking.time);
            
            // Remove the booking
            allBookings.splice(bookingIndex, 1);
            
            // Save updated bookings
            localStorage.setItem('babatundeBarberBookings', JSON.stringify(allBookings));
            
            // Update display
            loadBookings();
            
            showNotification(`Booking ${confirmationNumber} has been cancelled and the time slot is now available again.`, 'success');
        }
        
         // Add time slot back to schedule
         function addTimeSlotBackToSchedule(date, time) {
             // Fix timezone issue: ensure consistent date parsing
             const dayName = new Date(date + 'T12:00:00').toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();
            
            // Load current schedule
            const storedSchedule = localStorage.getItem('babatundeBarberSchedule');
            if (!storedSchedule) return;
            
            const schedule = JSON.parse(storedSchedule);
            
            // Add the time slot back if it doesn't exist
            if (!schedule[dayName]) {
                schedule[dayName] = [];
            }
            
            if (!schedule[dayName].includes(time)) {
                schedule[dayName].push(time);
                schedule[dayName].sort(); // Keep times sorted
                
                // Save updated schedule
                localStorage.setItem('babatundeBarberSchedule', JSON.stringify(schedule));
                
                // Dispatch event to update main site
                window.dispatchEvent(new CustomEvent('scheduleUpdated', {
                    detail: { schedule }
                }));
            }
        }
        
        // Format time for display
        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
                z-index: 10000;
                font-weight: 500;
                max-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            // Add animation styles
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(notification);
            
            // Remove after 5 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }
        
        // Load bookings when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadBookings();
        });
    </script>
</body>
</html>
