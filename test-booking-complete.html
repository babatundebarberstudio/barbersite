<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Booking Complete - Babatunde Barber</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #d4af37;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #b8941f;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Booking System Test</h1>
        <p>This page tests the complete booking flow including EmailJS integration.</p>
        
        <h2>Test Steps:</h2>
        <ol>
            <li>Click "Test Booking Flow" to simulate a complete booking</li>
            <li>Check the console for any errors</li>
            <li>Verify that emails are sent (check your email and matthewswondwesen1@gmail.com)</li>
        </ol>
        
        <button class="test-button" onclick="testCompleteBooking()">
            üöÄ Test Complete Booking Flow
        </button>
        
        <button class="test-button" onclick="testEmailJS()">
            üìß Test EmailJS Connection
        </button>
        
        <div class="test-results" id="test-results">
            <h3>Test Results:</h3>
            <p>Click a test button above to see results here.</p>
        </div>
    </div>

    <!-- Include EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <script>
        // Initialize EmailJS
        emailjs.init("B0bwe2zqFaC5Xrvir");
        
        // Test data
        const testBookingData = {
            service: 'mid-taper',
            additionalServices: ['beard-lineup', 'eyebrow-lineup'],
            date: '2025-01-15',
            time: '14:00',
            customerInfo: {
                name: 'John Doe',
                email: 'test@example.com',
                phone: '555-1234',
                notes: 'Test booking from test page'
            }
        };
        
        // Service configuration (copied from main script)
        const serviceConfig = {
            'mid-taper': { name: 'Mid Taper', price: 20, duration: 30 },
            'mid-fade': { name: 'Mid Fade', price: 20, duration: 30 },
            'low-taper': { name: 'Low Taper', price: 20, duration: 30 },
            'low-fade': { name: 'Low Fade', price: 20, duration: 30 },
            'high-taper': { name: 'High Taper', price: 20, duration: 30 },
            'high-fade': { name: 'High Fade', price: 20, duration: 30 },
            'line-up': { name: 'Line Up', price: 10, duration: 15 },
            'clean-up': { name: 'Clean Up', price: 15, duration: 20 },
            'burst-fade': { name: 'Burst Fade', price: 25, duration: 45 },
            'designs': { name: 'Hair Designs', price: 30, duration: 60 }
        };
        
        const additionalServicesConfig = {
            'beard-lineup': { name: 'Beard Line Up', price: 0 },
            'eyebrow-lineup': { name: 'Eyebrow Line Up', price: 0 },
            'braid-gel': { name: 'Braid Gel/Oil', price: 0 },
            'goatee-lineup': { name: 'Goatee Line Up', price: 0 },
            'design-option': { name: 'Custom Design', price: 15 }
        };
        
        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        async function testCompleteBooking() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test Results:</h3><p>Testing complete booking flow...</p>';
            
            try {
                const confirmationNumber = 'BB' + Date.now().toString().slice(-6);
                console.log('Testing booking with confirmation number:', confirmationNumber);
                
                // Test the email sending function
                await sendBookingEmails(testBookingData, confirmationNumber);
                
                resultsDiv.innerHTML = `
                    <h3>‚úÖ Test Results:</h3>
                    <p><strong>SUCCESS!</strong> Complete booking flow tested successfully.</p>
                    <p>Confirmation Number: ${confirmationNumber}</p>
                    <p>Check your email and matthewswondwesen1@gmail.com for confirmation emails.</p>
                    <p>Check the console for detailed logs.</p>
                `;
                
            } catch (error) {
                console.error('Test failed:', error);
                resultsDiv.innerHTML = `
                    <h3>‚ùå Test Results:</h3>
                    <p><strong>FAILED!</strong> Error: ${error.message}</p>
                    <p>Check the console for detailed error information.</p>
                `;
            }
        }
        
        async function testEmailJS() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>Test Results:</h3><p>Testing EmailJS connection...</p>';
            
            try {
                const result = await emailjs.send(
                    'service_32atpco',
                    'template_pysusaq',
                    {
                        to_email: 'test@example.com',
                        customer_name: 'Test User',
                        confirmation_number: 'TEST123',
                        appointment_date: 'Test Date',
                        appointment_time: 'Test Time',
                        service_name: 'Test Service',
                        service_price: 20,
                        additional_services: 'Test Additional Services',
                        total_price: 20,
                        customer_phone: '555-1234',
                        special_notes: 'Test Notes',
                        location: '812 Gaffield Pl',
                        contact_phone: '720-499-5415'
                    }
                );
                
                resultsDiv.innerHTML = `
                    <h3>‚úÖ EmailJS Test Results:</h3>
                    <p><strong>SUCCESS!</strong> EmailJS connection working.</p>
                    <p>Status: ${result.status}</p>
                    <p>Text: ${result.text}</p>
                `;
                
            } catch (error) {
                console.error('EmailJS test failed:', error);
                resultsDiv.innerHTML = `
                    <h3>‚ùå EmailJS Test Results:</h3>
                    <p><strong>FAILED!</strong> Error: ${error.message}</p>
                    <p>Check your EmailJS configuration.</p>
                `;
            }
        }
        
        // Email sending function (copied from main script)
        async function sendBookingEmails(bookingData, confirmationNumber) {
            const service = serviceConfig[bookingData.service];
            const additionalServices = bookingData.additionalServices.map(serviceKey => 
                additionalServicesConfig[serviceKey] || { name: serviceKey, price: 0 }
            );
            
            // Calculate total price
            let totalPrice = service.price;
            additionalServices.forEach(addService => {
                totalPrice += addService.price;
            });
            
            // Format additional services text
            const additionalServicesText = additionalServices.length > 0 
                ? additionalServices.map(addService => `- ${addService.name}${addService.price > 0 ? ` ($${addService.price})` : ' (Free)'}`).join('\n')
                : 'None';
            
            // Prepare template parameters for customer email
            const customerTemplateParams = {
                to_email: bookingData.customerInfo.email,
                customer_name: bookingData.customerInfo.name,
                confirmation_number: confirmationNumber,
                appointment_date: formatDate(new Date(bookingData.date)),
                appointment_time: formatTime(bookingData.time),
                service_name: service.name,
                service_price: service.price,
                additional_services: additionalServicesText,
                total_price: totalPrice,
                customer_phone: bookingData.customerInfo.phone,
                special_notes: bookingData.customerInfo.notes || 'None',
                location: '812 Gaffield Pl',
                contact_phone: '720-499-5415'
            };
            
            // Prepare template parameters for barber email
            const barberTemplateParams = {
                to_email: 'matthewswondwesen1@gmail.com',
                customer_name: bookingData.customerInfo.name,
                confirmation_number: confirmationNumber,
                appointment_date: formatDate(new Date(bookingData.date)),
                appointment_time: formatTime(bookingData.time),
                service_name: service.name,
                service_price: service.price,
                additional_services: additionalServicesText,
                total_price: totalPrice,
                customer_phone: bookingData.customerInfo.phone,
                customer_email: bookingData.customerInfo.email,
                special_notes: bookingData.customerInfo.notes || 'None',
                location: '812 Gaffield Pl',
                contact_phone: '720-499-5415'
            };
            
            try {
                // Send email to customer
                console.log('Sending confirmation email to customer:', bookingData.customerInfo.email);
                const customerResult = await emailjs.send(
                    'service_32atpco',
                    'template_pysusaq',
                    customerTemplateParams
                );
                
                // Send email to barber
                console.log('Sending booking notification to barber');
                const barberResult = await emailjs.send(
                    'service_32atpco',
                    'template_pysusaq',
                    barberTemplateParams
                );
                
                console.log('Both emails sent successfully');
                return { customerResult, barberResult };
                
            } catch (error) {
                console.error('Error sending emails:', error);
                throw error;
            }
        }
    </script>
</body>
</html>
